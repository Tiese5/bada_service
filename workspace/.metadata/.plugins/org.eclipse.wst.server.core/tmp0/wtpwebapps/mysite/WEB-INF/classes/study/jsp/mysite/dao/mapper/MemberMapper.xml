<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <!--  Mammper 시작-->
  <!-- 이 파일의 경로를 config.xml에 명시해야한다 -->
  
  <!-- Professor테이블에 대한 CRUD 기능을 구현하기 위한 Mapper -->
  <mapper namespace="MemberMapper">
 	<resultMap id="member" type="study.jsp.mysite.model.Member">
 		<result property="id" column="id"/>
 		<result property="name" column="name"/>
 		<result property="userId" column="user_id"/>
 		<result property="userPw" column="user_pw"/>
 		<result property="email" column="email"/>
 		<result property="gender" column="gender"/>
 		<result property="birthdate" column="birthdate"/>
 		<result property="tel" column="tel"/>
 		<result property="postcode" column="postcode"/>
 		<result property="addr1" column="addr1"/>
 		<result property="addr2" column="addr2"/>
 		<result property="profileImg" column="profile_img"/>
 		<result property="regDate" column="reg_date"/>
 		<result property="editDate" column="edit_date"/>
 	</resultMap>
 	<!-- 아이디 중복검사 -->
 	<select id="selectUserIdCount" parameterType="study.jsp.mysite.model.Member" resultType="int">
 		SELECT count(id) FROM member WHERE user_id = #{userId}
 	</select>
 	<!-- 이메일 중복검사 -->
 	<select id="selectEmailCount" parameterType="study.jsp.mysite.model.Member" resultType="int">
 		SELECT count(email) FROM member WHERE email = #{email}
 	</select>
 	
 	<!-- 회원정보 저장 -->
 	<insert id="inseltMember" parameterType="study.jsp.mysite.model.Member"
 	useGeneratedKeys="true" keyProperty="id">
 	INSERT INTO member(
 	name,user_id,user_pw,email,gender,birthdate,tel,postcode,
 	addr1,addr2,profile_img,reg_date,edit_date
 	)VALUES(
 	#{name},#{userId},password(#{userPw}),#{email},#{gender},#{birthdate},
 	#{tel},#{postcode},#{addr1},#{addr2},#{profileImg},now(),now()
 	)
 	</insert>
 	
 	<select id="selectLoginInfo" parameterType="study.jsp.mysite.model.Member" resultMap="member">
 		SELECT
 			id,name,user_id,user_pw,email,gender,DATE_FORMAT(birthdate,'%Y-%M-%D') AS birthdate,
 			tel,postcode,addr1,addr2,profile_img,reg_date,edit_date
 			FROM member
 			WHERE user_id=#{userId} AND user_pw=password(#{userPw})
 			ORDER by id DESC
 			LIMIT 0,1
 	</select>
 	
 	<update id="updateMemberPasswordByEmail" parameterType="study.jsp.mysite.model.Member">
 		UPDATE member SET user_pw=password(#{userPw}), edit_date=now()
 		WHERE email=#{email}
 	</update>
 	<!-- 현재 로그인 중인 회원이 비밀번호를 검사한다 -->
 	<select id="selectMemberPasswordCount" parameterType="study.jsp.mysite.model.Member"
 	resultType="int">
 		SELECT count(id) FROM member
 		WHERE id=#{id} AND user_pw=password(#{userPw})
 	</select>
 	
 	<!-- 회원정보를 삭제한다 : 탈퇴 -->
 	<delete id="deleteMember" parameterType="study.jsp.mysite.model.Member">
 		DELETE FROM member WHERE id=#{id};
 	</delete>
  </mapper>

	